var l=function(c){function d(d){var e=c("<audio />").get(0);e.src="assets/"+d+".wav";return e}function e(c,d){return{play:function(){e.play(c,d)},stop:function(){e.stop(c)}}}var f={};return c.extend(e,{play:function(e,g){g=g||4;f[e]||(f[e]=[d(e)]);var k=c.grep(f[e],function(c){return c.currentTime==c.duration||0==c.currentTime});if(k[0]){try{k[0].currentTime=0}catch(v){}k[0].play()}else if(!g||f[e].length<g)k=d(e),f[e].push(k),k.play()},stop:function(c){f[c]&&f[c].stop()}})}(jQuery);function m(c){var d=new Image;d.src=c;d.onerror=function(){console.log("Failed to load image: "+c)};return d}function n(c,d){return c&&d?c.x<d.x+d.width&&c.x+c.width>d.x&&c.y<d.y+d.height&&c.y+c.height>d.y:!1}Array.prototype.remove=function(c,d){var e=this.slice((d||c)+1||this.length);this.length=0>c?this.length+c:c;return this.push.apply(this,e)};
function p(c,d,e,f,h,g){this.b=c;this.a=m(this.b);var k=this;this.a.onload=function(){k.isReady=!0};this.m=d;this.x=f;this.y=h;this.width=12;this.height=8;this.update=function(){this.x+=e;if(this.x>=g.h-15||5>=this.x)this.y+=3,e=-e;this.y>g.i-20&&g.w();11==Math.floor(200*Math.random())&&(g.c.push(new q(this.x+5,this.y+10,-3,g,"enemy")),l.play("InvaderBullet"))};this.l=function(){this.isReady&&g.g.drawImage(this.a,this.x,this.y,12,8)}}
function r(c,d,e,f,h){this.b=c;this.a=m(this.b);var g=this;this.a.onload=function(){g.isReady=!0};this.x=e;this.y=f;this.width=12;this.height=8;this.update=function(){this.y+=d;this.y>h.i&&h.A(this)};this.l=function(){this.isReady&&h.g.drawImage(this.a,this.x,this.y,12,8)}}
function t(c,d,e){this.a=m("assets/Ship.png");var f=this;this.a.onload=function(){f.isReady=!0};this.m=10;this.x=c;this.y=d;this.width=12;this.height=8;this.update=function(){0>this.x?this.x=e.h:this.x>e.h&&(this.x=0);keydown.left&&(this.x-=2);keydown.right&&(this.x+=2)};this.l=function(){this.isReady&&e.g.drawImage(this.a,this.x,this.y,12,8)}}
function q(c,d,e,f,h){this.x=c;this.y=d;this.width=2;this.height=3;this.b=e;this.a=f;this.H=h;this.update=function(){this.y-=this.b;if(0>this.y||this.y>this.a.i)"player"===h&&(f.s=!1),f.u(this)};this.l=function(){f.g.fillStyle="white";f.g.fillRect(this.x,this.y,this.width,this.height)}}function u(){var c=window.a;c.tick();c.D();c.G()}document.getElementById("game").oncontextmenu=function(){return!1};
window.a=new function(){this.v=document.getElementById("game");this.h=parseInt(this.v.width);this.i=parseInt(this.v.height);this.a=[];this.c=[];this.b="";this.s=!1;this.j=0;this.o=this.B=!1;this.g=this.v.getContext("2d");this.F=function(){this.C();this.b=new t(this.h/2-15,this.i-20,this);if("ontouchstart"in window||"onmsgesturechange"in window){var c=m("assets/no-mobile.jpg"),d=this;c.onload=function(){d.g.drawImage(c,d.h/2-170,0,340,d.i)}}else window.b=window.setInterval(u,1E3/30)};this.C=function(){for(var c=
10,d=["assets/InvaderA_00.png","assets/InvaderB_00.png","assets/InvaderC_00.png"],e=0;4>e;e+=1){for(var f=0;10>f;f+=1){var h=new p(d[Math.floor(Math.random()*d.length)],10,1,10+20*f,c,this);this.a.push(h)}c+=20}3>=Math.floor(10*Math.random())&&(c=new r("assets/InvaderA_00.png",.5,Math.floor(this.h*Math.random()),20,this),this.a.push(c))};this.D=function(){this.b.update()};this.u=function(c){this.c.remove(this.c.indexOf(c))};this.A=function(c){this.a.remove(this.a.indexOf(c))};this.w=function(){confirm("Game Over!\n\nWould you like to play again?")?
location.reload():(this.paused=this.B=!0,window.clearInterval(window.b))};this.tick=function(){for(var c=0;c<this.a.length;c++)this.a[c].update();for(c=0;c<this.c.length;c++)this.c[c].update();if(keydown.space&&0==this.s&&0==this.o){var d=new q(this.b.x+5,this.b.y-3,3,this,"player");d.update();this.c.push(d);this.s=!0;l.play("ShipBullet")}0==this.a.length&&this.C();for(c=0;c<this.c.length;c++){if(n(this.c[c],this.b)){this.j=Math.max(0,this.j-50);--this.b.m;this.u(this.c[c]);0>=this.b.m&&this.w();
break}for(var e=0;e<this.a.length;e++)n(this.c[c],this.a[e])&&(d=this.c[c],"player"===d.H&&(this.a[e]instanceof p?(this.j+=100,l.play("ShipHit")):this.a[e]instanceof r&&(this.j+=500,this.b.m=Math.min(10,this.b.m+5)),this.s=!1,this.u(d),this.A(this.a[e])))}};this.G=function(){this.g.fillStyle="black";this.g.clearRect(0,0,this.h,this.i);this.g.fillRect(0,0,this.h,this.i);for(var c=0;c<this.a.length;c++)this.a[c].l();for(c=0;c<this.c.length;c++)this.c[c].l();this.b.l();this.g.fillStyle="white";this.g.fillText(this.j,
5,10);this.g.fillRect(0,this.i-2,this.b.m/10*this.h,2)}};window.a.F();
$(document).on("keypress",function(c){c.preventDefault();keydown.p&&0==window.a.B?window.a.o?(console.log("unpausing"),window.b=window.setInterval(u,1E3/30),window.a.o=!1):(console.log("pausing"),window.clearInterval(window.b),window.a.o=!0):keydown.f&&(document.fullScreen?(document.webkitRequestFullScreen&&document.webkitCancelFullScreen(),document.mozCancelFullScreen&&document.mozCancelFullScreen()):($("#game")[0].webkitRequestFullScreen&&$("#game")[0].webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),
$("#game")[0].mozRequestFullScreen&&$("#game")[0].mozRequestFullScreen()))});
